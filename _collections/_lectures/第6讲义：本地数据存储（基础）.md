---
title: ç¬¬6è®²ä¹‰ï¼šæœ¬åœ°æ•°æ®å­˜å‚¨ï¼ˆåŸºç¡€ï¼‰
date: 2026-02-05
permalink: /lectures/lecture06
show: true
---


**è¯¾ç¨‹**: Android ç§»åŠ¨åº”ç”¨å¼€å‘å…¥é—¨  
**å‘¨æ¬¡**: ç¬¬6å‘¨  
**ä¸»é¢˜**: æœ¬åœ°æ•°æ®å­˜å‚¨ï¼ˆåŸºç¡€ï¼‰  
**å­¦æ—¶**: 3è¯¾æ—¶ï¼ˆç†è®º2è¯¾æ—¶ + å®éªŒ1è¯¾æ—¶ï¼‰

> ğŸ“Œ **æœ¬å‘¨ç‰¹åˆ«æé†’**: ç¬¬6å‘¨å‘¨äº”ä¸º**ç¬¬ä¸€é˜¶æ®µé¡¹ç›®å±•ç¤º**ï¼ˆå•å±åº”ç”¨ï¼‰ï¼Œé¡¹ç›®è¦æ±‚è¯¦è§æœ¬è®²ä¹‰æœ«å°¾ã€‚

---

## ğŸ“‹ æœ¬èŠ‚è¯¾å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬èŠ‚è¯¾åï¼Œå­¦ç”Ÿåº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… ä½¿ç”¨ SharedPreferences ä¿å­˜å’Œè¯»å–é”®å€¼å¯¹æ•°æ®
2. âœ… æ¸…æ¥šåŒºåˆ†å†…éƒ¨å­˜å‚¨å’Œå¤–éƒ¨å­˜å‚¨çš„åœºæ™¯å’Œç”¨æ³•
3. âœ… ä½¿ç”¨å¤šç§æ–¹å¼å®Œæˆæ–‡ä»¶çš„è¯»å†™æ“ä½œ
4. âœ… äº†è§£ Android æƒé™æœºåˆ¶çš„åŸºæœ¬æ¦‚å¿µå’Œå£°æ˜æ–¹å¼
5. âœ… å®ç°ç”¨æˆ·åå¥½è®¾ç½®çš„æŒä¹…åŒ–ä¿å­˜ä¸æ¢å¤
6. âœ… ç‹¬ç«‹å¼€å‘ä¸€ä¸ªåŸºäºæ–‡ä»¶å­˜å‚¨çš„è®°äº‹æœ¬åº”ç”¨

---

## ğŸ’¾ ç¬¬ä¸€éƒ¨åˆ†ï¼šä¸ºä»€ä¹ˆéœ€è¦æ•°æ®å­˜å‚¨ï¼Ÿ

### 1.1 å›é¡¾ä¹‹å‰çš„é—®é¢˜

å›æƒ³ä¸€ä¸‹ä¹‹å‰åšè¿‡çš„åº”ç”¨â€”â€”å…³æ‰å†æ‰“å¼€ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ¶ˆå¤±äº†ã€‚

```
âŒ æ²¡æœ‰å­˜å‚¨æœºåˆ¶:
æ‰“å¼€åº”ç”¨ â†’ ç”¨æˆ·è¾“å…¥æ•°æ® â†’ å…³é—­åº”ç”¨ â†’ å†æ‰“å¼€ â†’ æ•°æ®å…¨æ²¡äº†

âœ… æœ‰å­˜å‚¨æœºåˆ¶:
æ‰“å¼€åº”ç”¨ â†’ ç”¨æˆ·è¾“å…¥æ•°æ® â†’ å…³é—­åº”ç”¨ â†’ æ•°æ®è‡ªåŠ¨ä¿å­˜
å†æ‰“å¼€åº”ç”¨ â†’ æ•°æ®å®Œå¥½æ— æŸ âœ“
```

**ç”Ÿæ´»ä¸­çš„ç±»æ¯”**:

- ğŸ“ è®°äº‹æœ¬åº”ç”¨ â€” å…³æ‰å†å¼€ï¼Œç¬”è®°è¿˜åœ¨
- ğŸ® æ‰‹æœºæ¸¸æˆ â€” é€€å‡ºåå­˜æ¡£ä¸ä¸¢å¤±
- âš™ï¸ æ‰‹æœºè®¾ç½® â€” æ·±è‰²æ¨¡å¼çš„å¼€å…³è®°ä½äº†é€‰æ‹©
- ğŸ” å¾®ä¿¡ â€” "è®°ä½å¯†ç "åŠŸèƒ½

### 1.2 Android æœ¬åœ°å­˜å‚¨çš„å››ç§æ–¹å¼

|å­˜å‚¨æ–¹å¼|é€‚ç”¨åœºæ™¯|æ•°æ®æ ¼å¼|æœ¬å‘¨æ¶‰åŠ|
|---|---|---|---|
|**SharedPreferences**|ç®€å•é”®å€¼å¯¹ï¼ˆè®¾ç½®ã€çŠ¶æ€ï¼‰|Key-Value|âœ… é‡ç‚¹|
|**æ–‡ä»¶å­˜å‚¨**|æ–‡æœ¬ã€å›¾ç‰‡ç­‰æ–‡ä»¶|ä»»æ„|âœ… é‡ç‚¹|
|**SQLite æ•°æ®åº“**|ç»“æ„åŒ–æ•°æ®ã€å¤§é‡è®°å½•|å…³ç³»å‹è¡¨æ ¼|ç¬¬8å‘¨|
|**Room æ•°æ®åº“**|ç»“æ„åŒ–æ•°æ®ï¼ˆGoogle æ¨èï¼‰|ORM + è¡¨æ ¼|ç¬¬9å‘¨|

**å¿«é€Ÿé€‰æ‹©æŒ‡å—**:

```
æ•°æ®é‡å°‘ï¼Œé”®å€¼å¯¹å½¢å¼ï¼Ÿ          â†’ SharedPreferences
éœ€è¦ä¿å­˜æ–‡æœ¬/å›¾ç‰‡ç­‰æ–‡ä»¶ï¼Ÿ        â†’ æ–‡ä»¶å­˜å‚¨
æ•°æ®é‡å¤§ï¼Œéœ€è¦æŸ¥è¯¢/æ’åº/å…³è”ï¼Ÿ   â†’ SQLite / Roomï¼ˆåç»­å­¦ä¹ ï¼‰
```

---

## âš™ï¸ ç¬¬äºŒéƒ¨åˆ†ï¼šSharedPreferences

### 2.1 ä»€ä¹ˆæ˜¯ SharedPreferencesï¼Ÿ

**SharedPreferencesï¼ˆç®€ç§° SPï¼‰** æ˜¯ Android æœ€ç®€å•çš„æ•°æ®æŒä¹…åŒ–æ–¹å¼ã€‚

- ä»¥ **é”®å€¼å¯¹ (Key-Value)** å½¢å¼å­˜å‚¨
- åº•å±‚ä¿å­˜ä¸ºä¸€ä¸ª **XML æ–‡ä»¶**
- é€‚åˆå­˜å‚¨å°‘é‡ã€ç®€å•çš„æ•°æ®

**ç±»æ¯”ä¸€ä¸ªå°æœ¬å­**:

```
SharedPreferences å®ä¾‹ï¼ˆæ–‡ä»¶å: settingsï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  "username"    â†’ "Alice"     â”‚  String
â”‚  "isLoggedIn"  â†’ true        â”‚  Boolean
â”‚  "theme"       â†’ "dark"      â”‚  String
â”‚  "fontSize"    â†’ 16          â”‚  Int
â”‚  "lastLogin"   â†’ 1706123456  â”‚  Long
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è·å–å®ä¾‹

```kotlin
// æ–¹å¼ä¸€ï¼šæŒ‡å®šæ–‡ä»¶åï¼ˆæ¨èï¼Œå¯ä»¥æœ‰å¤šä¸ª SP æ–‡ä»¶ï¼‰
val prefs = getSharedPreferences("settings", Context.MODE_PRIVATE)

// æ–¹å¼äºŒï¼šä½¿ç”¨é»˜è®¤å®ä¾‹ï¼ˆä¸€ä¸ªåº”ç”¨å…±äº«ä¸€ä¸ªï¼‰
val prefs = PreferenceManager.getDefaultSharedPreferences(this)
```

**å‚æ•°è¯´æ˜**:

- `"settings"` â€” æ–‡ä»¶åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»º `settings.xml`
- `Context.MODE_PRIVATE` â€” è®¿é—®æ¨¡å¼ï¼Œåªå…è®¸æœ¬åº”ç”¨è¯»å†™ï¼ˆ**å§‹ç»ˆä½¿ç”¨æ­¤æ¨¡å¼**ï¼‰

### 2.3 å†™å…¥æ•°æ®

å†™å…¥**å¿…é¡»**é€šè¿‡ `Editor` å¯¹è±¡ï¼Œä¸”**å¿…é¡»**åœ¨æœ€åè°ƒç”¨ `apply()` æˆ– `commit()`ã€‚

```kotlin
val prefs = getSharedPreferences("settings", Context.MODE_PRIVATE)
val editor = prefs.edit()                          // è·å– Editor

editor.putString("username", "Alice")             // å†™å…¥ String
editor.putInt("age", 25)                          // å†™å…¥ Int
editor.putLong("score", 9800L)                    // å†™å…¥ Long
editor.putFloat("balance", 100.50f)               // å†™å…¥ Float
editor.putBoolean("isLoggedIn", true)             // å†™å…¥ Boolean

editor.apply()                                     // âš ï¸ å¿…é¡»è°ƒç”¨ï¼å¼‚æ­¥ä¿å­˜ï¼ˆæ¨èï¼‰
// editor.commit()                                // åŒæ­¥ä¿å­˜ï¼Œè¿”å› Boolean è¡¨ç¤ºæ˜¯å¦æˆåŠŸ
```

**âš ï¸ æœ€å¸¸è§çš„å‘: å¿˜è®° apply()**

```kotlin
// âŒ é”™è¯¯ï¼šæ²¡æœ‰ apply()ï¼Œæ•°æ®æ°¸è¿œä¸ä¼šå†™å…¥æ–‡ä»¶ï¼
val editor = prefs.edit()
editor.putString("username", "Alice")
// è¿™é‡Œç»“æŸäº†â€”â€”æ•°æ®ä¸¢å¤±

// âœ… æ­£ç¡®
val editor = prefs.edit()
editor.putString("username", "Alice")
editor.apply()   // è¿™è¡Œä¸èƒ½çœ
```

**Kotlin ç®€æ´å†™æ³•ï¼ˆæ¨èï¼‰**:

```kotlin
// edit{} ä»£ç å—ä¼šè‡ªåŠ¨è°ƒç”¨ apply()ï¼Œæ— éœ€æ‰‹åŠ¨
getSharedPreferences("settings", Context.MODE_PRIVATE).edit {
    putString("username", "Alice")
    putInt("age", 25)
    putBoolean("isLoggedIn", true)
}
```

### 2.4 è¯»å–æ•°æ®

```kotlin
val prefs = getSharedPreferences("settings", Context.MODE_PRIVATE)

// è¯»å–æ—¶å¿…é¡»æä¾›é»˜è®¤å€¼ï¼ˆkey ä¸å­˜åœ¨æ—¶è¿”å›è¯¥é»˜è®¤å€¼ï¼‰
val username   = prefs.getString("username", "æ¸¸å®¢")       // é»˜è®¤ "æ¸¸å®¢"
val age        = prefs.getInt("age", 0)                    // é»˜è®¤ 0
val score      = prefs.getLong("score", 0L)                // é»˜è®¤ 0L
val balance    = prefs.getFloat("balance", 0f)             // é»˜è®¤ 0f
val isLoggedIn = prefs.getBoolean("isLoggedIn", false)     // é»˜è®¤ false

println("ç”¨æˆ·: $username, å¹´é¾„: $age, å·²ç™»å½•: $isLoggedIn")
```

**é»˜è®¤å€¼çš„ä½œç”¨è§£é‡Š**:

```
ç¬¬ä¸€æ¬¡å®‰è£…åº”ç”¨ï¼ŒSP æ–‡ä»¶æ˜¯ç©ºçš„ï¼Œæ‰€æœ‰ key éƒ½ä¸å­˜åœ¨ã€‚

prefs.getString("username", "æ¸¸å®¢")
â†’ "username" ä¸å­˜åœ¨ â†’ è¿”å›é»˜è®¤å€¼ "æ¸¸å®¢"

ä¹‹åæ‰§è¡Œäº† putString("username", "Alice") + apply()

prefs.getString("username", "æ¸¸å®¢")
â†’ "username" ç°åœ¨å­˜åœ¨ï¼Œå€¼ä¸º "Alice" â†’ è¿”å› "Alice"
```

### 2.5 åˆ é™¤æ•°æ®

```kotlin
val editor = prefs.edit()

// åˆ é™¤å•ä¸ª key
editor.remove("username")
editor.apply()

// æ¸…ç©ºè¯¥ SP æ–‡ä»¶é‡Œçš„æ‰€æœ‰æ•°æ®
editor.clear()
editor.apply()
```

### 2.6 åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨

```kotlin
if (prefs.contains("username")) {
    val name = prefs.getString("username", "")
    println("å·²ä¿å­˜çš„ç”¨æˆ·å: $name")
} else {
    println("é¦–æ¬¡ä½¿ç”¨ï¼Œæœªè®¾ç½®ç”¨æˆ·å")
}
```

### 2.7 ç›‘å¬æ•°æ®å˜åŒ–

```kotlin
val listener = SharedPreferences.OnSharedPreferenceChangeListener { sp, key ->
    when (key) {
        "theme" -> {
            val newTheme = sp.getString("theme", "light")
            applyTheme(newTheme)
            Log.d("SP", "ä¸»é¢˜å˜æ›´ â†’ $newTheme")
        }
    }
}

prefs.registerOnSharedPreferenceChangeListener(listener)

// âš ï¸ åœ¨ onDestroy ä¸­æ³¨é”€ï¼Œé¿å…å†…å­˜æ³„æ¼
override fun onDestroy() {
    super.onDestroy()
    prefs.unregisterOnSharedPreferenceChangeListener(listener)
}
```

### 2.8 å®Œæ•´å®ä¾‹ï¼šè®°ä½ç™»å½•çŠ¶æ€

```kotlin
class LoginActivity : AppCompatActivity() {

    private lateinit var prefs: SharedPreferences

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_login)

        prefs = getSharedPreferences("login_prefs", Context.MODE_PRIVATE)

        // â”€â”€â”€ å¯åŠ¨æ—¶æ£€æŸ¥ï¼šæ˜¯å¦å·²ç™»å½•ï¼Ÿ â”€â”€â”€
        if (prefs.getBoolean("isLoggedIn", false)) {
            val name = prefs.getString("username", "ç”¨æˆ·")
            Toast.makeText(this, "æ¬¢è¿å›æ¥ï¼Œ$nameï¼", Toast.LENGTH_SHORT).show()
            startActivity(Intent(this, MainActivity::class.java))
            finish()   // é”€æ¯ç™»å½•é¡µ
            return
        }

        // â”€â”€â”€ æ¢å¤ä¹‹å‰è®°ä½çš„ç”¨æˆ·å â”€â”€â”€
        val savedName = prefs.getString("savedUsername", "")
        if (savedName.isNotEmpty()) {
            findViewById<EditText>(R.id.usernameEdit).setText(savedName)
            findViewById<CheckBox>(R.id.rememberMe).isChecked = true
        }

        // â”€â”€â”€ ç™»å½•æŒ‰é’® â”€â”€â”€
        findViewById<Button>(R.id.loginBtn).setOnClickListener {
            val username = findViewById<EditText>(R.id.usernameEdit).text.toString().trim()
            val password = findViewById<EditText>(R.id.passwordEdit).text.toString()
            val remember = findViewById<CheckBox>(R.id.rememberMe).isChecked

            if (username.isEmpty() || password.isEmpty()) {
                Toast.makeText(this, "ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º", Toast.LENGTH_SHORT).show()
                return@setOnClickListener
            }

            // æ¨¡æ‹ŸéªŒè¯ï¼ˆå®é™…é¡¹ç›®åº”è¯¥è”ç½‘éªŒè¯ï¼‰
            if (username == "admin" && password == "123456") {
                prefs.edit {
                    if (remember) {
                        putBoolean("isLoggedIn", true)
                        putString("username", username)
                    }
                    putString("savedUsername", username)
                }
                Toast.makeText(this, "ç™»å½•æˆåŠŸï¼", Toast.LENGTH_SHORT).show()
                startActivity(Intent(this, MainActivity::class.java))
                finish()
            } else {
                Toast.makeText(this, "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯", Toast.LENGTH_SHORT).show()
            }
        }
    }
}
```

---

## ğŸ“ ç¬¬ä¸‰éƒ¨åˆ†ï¼šå†…éƒ¨å­˜å‚¨ä¸å¤–éƒ¨å­˜å‚¨

### 3.1 ä¸¤ç§å­˜å‚¨å¯¹æ¯”

|ç‰¹æ€§|å†…éƒ¨å­˜å‚¨|å¤–éƒ¨å­˜å‚¨|
|---|---|---|
|**è·¯å¾„**|`/data/data/åŒ…å/files/`|`/storage/emulated/0/Android/data/åŒ…å/files/`|
|**è®¿é—®æƒé™**|ä»…æœ¬åº”ç”¨å¯è¯»å†™|å…¶ä»–åº”ç”¨ä¹Ÿå¯èƒ½è®¿é—®|
|**éœ€è¦æƒé™**|âŒ ä¸éœ€è¦|éƒ¨åˆ†æƒ…å†µéœ€è¦|
|**å¸è½½åº”ç”¨æ—¶**|æ•°æ®è‡ªåŠ¨åˆ é™¤|å¯èƒ½ä¿ç•™|
|**å­˜å‚¨ç©ºé—´**|æ‰‹æœºå†…å­˜ï¼ˆè¾ƒå°ï¼‰|SD å¡ï¼ˆè¾ƒå¤§ï¼‰|
|**é€‚ç”¨åœºæ™¯**|ç§å¯†æ•°æ®ã€ç¼“å­˜|ç”¨æˆ·å¯è®¿é—®çš„æ–‡ä»¶|

### 3.2 å†…éƒ¨å­˜å‚¨ â€” ç›®å½•ä¸åŸºæœ¬æ“ä½œ

```kotlin
// è·å–å†…éƒ¨å­˜å‚¨ç›®å½•
val dir: File = filesDir
// è·¯å¾„ç¤ºä¾‹: /data/data/com.example.myapp/files/

// ç¼“å­˜ç›®å½•ï¼ˆç³»ç»Ÿå¯èƒ½åœ¨ç©ºé—´ä¸è¶³æ—¶è‡ªåŠ¨æ¸…ç†ï¼‰
val cacheDirectory: File = cacheDir
// è·¯å¾„ç¤ºä¾‹: /data/data/com.example.myapp/cache/

println("å†…éƒ¨å­˜å‚¨: ${filesDir.absolutePath}")
```

#### å†™å…¥æ–‡ä»¶

```kotlin
// â”€â”€â”€ æ–¹å¼ä¸€: File + writeTextï¼ˆè¦†ç›–å†™å…¥ï¼‰ â”€â”€â”€
val file = File(filesDir, "notes.txt")
file.writeText("ç¬¬ä¸€æ¡ç¬”è®°å†…å®¹")   // æ•´ä¸ªæ–‡ä»¶è¢«è¦†ç›–

// â”€â”€â”€ æ–¹å¼äºŒ: File + appendTextï¼ˆè¿½åŠ å†™å…¥ï¼‰ â”€â”€â”€
file.appendText("\nç¬¬äºŒæ¡ç¬”è®°å†…å®¹")  // åœ¨æœ«å°¾è¿½åŠ 

// â”€â”€â”€ æ–¹å¼ä¸‰: openFileOutputï¼ˆåº•å±‚æµå¼å†™å…¥ï¼‰ â”€â”€â”€
val fos = openFileOutput("notes.txt", Context.MODE_APPEND)  // APPEND = è¿½åŠ 
fos.write("è¿½åŠ çš„å†…å®¹\n".toByteArray())
fos.close()   // âš ï¸ å¿…é¡»å…³é—­æµ
```

**Mode å¯¹æ¯”**:

|Mode|å«ä¹‰|
|---|---|
|`Context.MODE_PRIVATE`|è¦†ç›–å†™å…¥ï¼ˆé»˜è®¤ï¼‰|
|`Context.MODE_APPEND`|è¿½åŠ å†™å…¥|

#### è¯»å–æ–‡ä»¶

```kotlin
// â”€â”€â”€ æ–¹å¼ä¸€: File + readTextï¼ˆä¸€æ¬¡æ€§è¯»å…¥ï¼Œæ¨èï¼‰ â”€â”€â”€
val file = File(filesDir, "notes.txt")
if (file.exists()) {
    val content: String = file.readText()
    println(content)
}

// â”€â”€â”€ æ–¹å¼äºŒ: File + readLinesï¼ˆé€è¡Œè¯»å…¥ï¼‰ â”€â”€â”€
val lines: List<String> = file.readLines()
lines.forEachIndexed { index, line ->
    println("ç¬¬ ${index + 1} è¡Œ: $line")
}

// â”€â”€â”€ æ–¹å¼ä¸‰: openFileInputï¼ˆåº•å±‚æµå¼è¯»å…¥ï¼‰ â”€â”€â”€
val fis = openFileInput("notes.txt")
val content = fis.bufferedReader().readText()
fis.close()
```

#### åˆ é™¤ä¸åˆ—ä¸¾

```kotlin
// åˆ é™¤å•ä¸ªæ–‡ä»¶
val file = File(filesDir, "notes.txt")
val deleted: Boolean = file.delete()
println("åˆ é™¤æˆåŠŸ: $deleted")

// åˆ—ä¸¾å†…éƒ¨å­˜å‚¨ä¸­æ‰€æœ‰æ–‡ä»¶å
val fileNames: Array<String> = fileList()
fileNames.forEach { println("æ–‡ä»¶: $it") }
```

### 3.3 å¤–éƒ¨å­˜å‚¨

#### è·å–ç›®å½•

```kotlin
// åº”ç”¨ä¸“å±å¤–éƒ¨ç›®å½•ï¼ˆä¸éœ€è¦ç‰¹æ®Šæƒé™ï¼Œå¸è½½æ—¶åˆ é™¤ï¼‰
val extDir: File? = getExternalFilesDir(null)
// è·¯å¾„: /storage/emulated/0/Android/data/com.example.myapp/files/

// æŒ‰ç±»å‹è·å–å­ç›®å½•
val docs      = getExternalFilesDir(Environment.DIRECTORY_DOCUMENTS)
val downloads = getExternalFilesDir(Environment.DIRECTORY_DOWNLOADS)
val pictures  = getExternalFilesDir(Environment.DIRECTORY_PICTURES)
```

#### å†™å…¥ä¸è¯»å–

```kotlin
val extDir = getExternalFilesDir(null)
if (extDir != null) {
    val file = File(extDir, "export.txt")
    file.writeText("å¯¼å‡ºçš„å†…å®¹")
    println("ä¿å­˜åˆ°: ${file.absolutePath}")
} else {
    Toast.makeText(this, "å¤–éƒ¨å­˜å‚¨ä¸å¯ç”¨", Toast.LENGTH_SHORT).show()
}
```

#### æ£€æŸ¥å¯ç”¨æ€§

```kotlin
fun isExternalStorageAvailable(): Boolean {
    return getExternalFilesDir(null) != null
}
```

### 3.4 é€‰æ‹©å“ªç§å­˜å‚¨ï¼Ÿ

```
å®é™…å†³ç­–æµç¨‹:

æ•°æ®æ˜¯é”®å€¼å¯¹ï¼ˆè®¾ç½®ã€å¼€å…³ã€ç”¨æˆ·åï¼‰?
    â†’ âœ… SharedPreferences

æ•°æ®æ˜¯æ–‡æœ¬/å›¾ç‰‡æ–‡ä»¶ï¼Œä¸”æ˜¯ç§å¯†çš„?
    â†’ âœ… å†…éƒ¨å­˜å‚¨ (filesDir)

æ•°æ®æ˜¯æ–‡æœ¬/å›¾ç‰‡æ–‡ä»¶ï¼Œç”¨æˆ·å¯èƒ½éœ€è¦å¯¼å‡ºæˆ–å…±äº«?
    â†’ âœ… å¤–éƒ¨å­˜å‚¨ (getExternalFilesDir)

æ•°æ®é‡å¤§ï¼Œéœ€è¦æœç´¢ã€æ’åºã€å¤šè¡¨å…³è”?
    â†’ åç»­å­¦ä¹  SQLite / Room
```

---

## ğŸ” ç¬¬å››éƒ¨åˆ†ï¼šåº”ç”¨æƒé™åŸºç¡€

### 4.1 ä¸ºä»€ä¹ˆéœ€è¦æƒé™ï¼Ÿ

Android æŠŠæ‰‹æœºç¡¬ä»¶å’Œç”¨æˆ·ç§å¯†æ•°æ®å°é”èµ·æ¥ï¼Œåº”ç”¨**å¿…é¡»å…ˆç”³è¯·æƒé™ï¼Œæ‰èƒ½è®¿é—®**ã€‚

```
å¸¸è§çš„å—æƒé™ä¿æŠ¤çš„èµ„æº:
ğŸ“ GPS å®šä½           â†’ ACCESS_FINE_LOCATION
ğŸ“· ç›¸æœº               â†’ CAMERA
ğŸ“ é€šè®¯å½•             â†’ READ_CONTACTS / WRITE_CONTACTS
ğŸ“± çŸ­ä¿¡               â†’ SEND_SMS
ğŸ¤ è¯ç­’               â†’ RECORD_AUDIO
ğŸŒ äº’è”ç½‘             â†’ INTERNET
```

### 4.2 æ™®é€šæƒé™ vs å±é™©æƒé™

||æ™®é€šæƒé™|å±é™©æƒé™|
|---|---|---|
|**é£é™©**|ä½ï¼ˆä¸æ¶‰åŠç”¨æˆ·éšç§ï¼‰|é«˜ï¼ˆæ¶‰åŠç”¨æˆ·éšç§ï¼‰|
|**æˆäºˆæ–¹å¼**|å®‰è£…æ—¶è‡ªåŠ¨æˆäºˆ|è¿è¡Œæ—¶å¼¹çª—ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»"å…è®¸"|
|**ä¸¾ä¾‹**|INTERNET, VIBRATE|CAMERA, ACCESS_FINE_LOCATION|

### 4.3 å£°æ˜æƒé™

æ‰€æœ‰æƒé™éƒ½éœ€è¦åœ¨ `AndroidManifest.xml` ä¸­å£°æ˜ï¼š

```xml
<manifest ...>

    <!-- æ™®é€šæƒé™ï¼ˆå£°æ˜å³å¯ï¼Œè‡ªåŠ¨è·å¾—ï¼‰ -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.VIBRATE" />

    <!-- å±é™©æƒé™ï¼ˆå£°æ˜ + è¿è¡Œæ—¶å¼¹çª—ç”³è¯·ï¼‰ -->
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />

    <application ...>
        ...
    </application>

</manifest>
```

### 4.4 è¿è¡Œæ—¶ç”³è¯·æƒé™ï¼ˆå±é™©æƒé™ï¼‰

```kotlin
import androidx.core.content.ContextCompat
import android.content.pm.PackageManager

class MainActivity : AppCompatActivity() {

    private val REQUEST_CAMERA = 101   // æƒé™è¯·æ±‚ç ï¼ˆè‡ªå®šä¹‰æ•´æ•°ï¼‰

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        findViewById<Button>(R.id.btnOpenCamera).setOnClickListener {
            checkAndRequestCamera()
        }
    }

    /** æ£€æŸ¥æ˜¯å¦å·²æœ‰æƒé™ï¼Œæ²¡æœ‰åˆ™å¼¹çª—ç”³è¯· */
    private fun checkAndRequestCamera() {
        val granted = ContextCompat.checkSelfPermission(
            this,
            android.Manifest.permission.CAMERA
        ) == PackageManager.PERMISSION_GRANTED

        if (granted) {
            openCamera()   // å·²æœ‰æƒé™ï¼Œç›´æ¥ä½¿ç”¨
        } else {
            // å¼¹çª—è®©ç”¨æˆ·æˆæƒ
            requestPermissions(
                arrayOf(android.Manifest.permission.CAMERA),
                REQUEST_CAMERA
            )
        }
    }

    /** ç³»ç»Ÿå›è°ƒï¼šç”¨æˆ·ç‚¹å‡»å…è®¸/æ‹’ç»åè§¦å‘ */
    override fun onRequestPermissionsResult(
        requestCode: Int,
        permissions: Array<out String>,
        grantResults: IntArray
    ) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults)
        if (requestCode == REQUEST_CAMERA) {
            if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                Toast.makeText(this, "ç›¸æœºæƒé™å·²æˆäºˆ âœ“", Toast.LENGTH_SHORT).show()
                openCamera()
            } else {
                Toast.makeText(this, "æœªæˆäºˆç›¸æœºæƒé™ï¼Œæ— æ³•ä½¿ç”¨æ­¤åŠŸèƒ½", Toast.LENGTH_SHORT).show()
            }
        }
    }

    private fun openCamera() {
        Toast.makeText(this, "æ‰“å¼€ç›¸æœºâ€¦", Toast.LENGTH_SHORT).show()
    }
}
```

**æƒé™ç”³è¯·æµç¨‹å›¾**:

```
ä»£ç è°ƒç”¨ requestPermissions()
        â†“
ç³»ç»Ÿå¼¹å‡ºæˆæƒçª—å£ï¼ˆ"å…è®¸/æ‹’ç»"ï¼‰
        â†“
ç”¨æˆ·ç‚¹å‡»
        â†“
        â”œâ”€â”€ å…è®¸ â†’ onRequestPermissionsResult (GRANTED) â†’ æ­£å¸¸ä½¿ç”¨
        â””â”€â”€ æ‹’ç» â†’ onRequestPermissionsResult (DENIED)  â†’ æç¤ºç”¨æˆ·
```

### 4.5 æœ¬å‘¨ä½œä¸šä¸æƒé™çš„å…³ç³»

**æœ¬å‘¨è®°äº‹æœ¬åº”ç”¨ä½¿ç”¨å†…éƒ¨å­˜å‚¨ï¼Œå®Œå…¨ä¸éœ€è¦å£°æ˜æˆ–ç”³è¯·ä»»ä½•æƒé™ã€‚**

```kotlin
// âœ… å†…éƒ¨å­˜å‚¨ â€” é›¶æƒé™
File(filesDir, "note.txt").writeText("å†…å®¹")

// âœ… åº”ç”¨ä¸“å±å¤–éƒ¨å­˜å‚¨ â€” åŒæ ·é›¶æƒé™
File(getExternalFilesDir(null), "note.txt").writeText("å†…å®¹")
```

æƒé™çš„è¯¦ç»†å®è·µä¼šåœ¨åç»­**ç¬¬10å‘¨ï¼ˆç½‘ç»œè®¿é—®ï¼‰**å’Œ**ç¬¬11å‘¨ï¼ˆå¤šåª’ä½“ï¼‰**ä¸­é‡ç‚¹ç»ƒä¹ ã€‚

---

## ğŸ§ª ç¬¬äº”éƒ¨åˆ†ï¼šå®éªŒ

### 5.1 å®éªŒä¸€ï¼šç”¨æˆ·åå¥½è®¾ç½®ä¿å­˜

**ç›®æ ‡**: åˆ›å»ºä¸€ä¸ªè®¾ç½®é¡µé¢ï¼ŒåŒ…å«å¤šç§æ§ä»¶ï¼›ç”¨æˆ·çš„é€‰æ‹©å…³é—­åº”ç”¨åä»èƒ½è‡ªåŠ¨æ¢å¤ã€‚

#### åŠŸèƒ½æ¸…å•

```
è®¾ç½®é¡µé¢åŒ…å«:
â‘  ç”¨æˆ·æ˜µç§°è¾“å…¥  â€” EditText
â‘¡ ä¸»é¢˜é€‰æ‹©      â€” RadioGroupï¼ˆæµ…è‰² / æ·±è‰² / è·Ÿéšç³»ç»Ÿï¼‰
â‘¢ å­—ä½“å¤§å°      â€” SeekBarï¼ˆå° / ä¸­ / å¤§ï¼Œå…±5æ¡£ï¼‰
â‘£ å£°éŸ³æé†’å¼€å…³  â€” SwitchCompat
â‘¤ ä¿å­˜æŒ‰é’®      â€” ç‚¹å‡»åå†™å…¥ SharedPreferences
â‘¥ æ¢å¤é»˜è®¤æŒ‰é’®  â€” å¼¹å‡ºç¡®è®¤ Dialog åæ¸…ç©ºå¹¶é‡ç½®
â‘¦ å¯åŠ¨é¡µé¢æ—¶    â€” è‡ªåŠ¨ä» SP åŠ è½½ä¸Šæ¬¡ä¿å­˜çš„æ•°æ®
```

#### å¸ƒå±€æ–‡ä»¶ (`activity_settings.xml`)

```xml
<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:fillViewport="true">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="24dp">

        <!-- é¡µé¢æ ‡é¢˜ -->
        <TextView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="âš™ï¸ åº”ç”¨è®¾ç½®"
            android:textSize="24sp"
            android:textStyle="bold"
            android:textColor="#028090"
            android:layout_marginBottom="28dp" />

        <!-- â”€â”€ ç”¨æˆ·æ˜µç§° â”€â”€ -->
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="ç”¨æˆ·æ˜µç§°"
            android:textSize="14sp"
            android:textColor="#757575"
            android:layout_marginBottom="4dp" />

        <EditText
            android:id="@+id/nicknameEdit"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="è¯·è¾“å…¥æ˜µç§°"
            android:inputType="text"
            android:textSize="16sp"
            android:layout_marginBottom="24dp" />

        <!-- â”€â”€ ä¸»é¢˜é€‰æ‹© â”€â”€ -->
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="ä¸»é¢˜"
            android:textSize="14sp"
            android:textColor="#757575"
            android:layout_marginBottom="8dp" />

        <RadioGroup
            android:id="@+id/themeGroup"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:layout_marginBottom="24dp">

            <RadioButton
                android:id="@+id/radioLight"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="â˜€ï¸ æµ…è‰²"
                android:textSize="16sp"
                android:layout_marginEnd="20dp" />

            <RadioButton
                android:id="@+id/radioDark"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="ğŸŒ™ æ·±è‰²"
                android:textSize="16sp"
                android:layout_marginEnd="20dp" />

            <RadioButton
                android:id="@+id/radioAuto"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="ğŸ”„ è·Ÿéšç³»ç»Ÿ"
                android:textSize="16sp" />

        </RadioGroup>

        <!-- â”€â”€ å­—ä½“å¤§å° â”€â”€ -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical"
            android:layout_marginBottom="4dp">

            <TextView
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="å­—ä½“å¤§å°"
                android:textSize="14sp"
                android:textColor="#757575" />

            <TextView
                android:id="@+id/fontSizeLabel"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="16sp"
                android:textSize="14sp"
                android:textColor="#028090"
                android:textStyle="bold" />

        </LinearLayout>

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical"
            android:layout_marginBottom="24dp">

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="å°"
                android:textSize="12sp"
                android:textColor="#9E9E9E" />

            <SeekBar
                android:id="@+id/fontSizeSeekBar"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:max="4"
                android:progress="2"
                android:layout_marginHorizontal="8dp" />

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="å¤§"
                android:textSize="20sp"
                android:textColor="#9E9E9E" />

        </LinearLayout>

        <!-- â”€â”€ å£°éŸ³æé†’å¼€å…³ â”€â”€ -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical"
            android:layout_marginBottom="36dp">

            <TextView
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="å£°éŸ³æé†’"
                android:textSize="16sp"
                android:textColor="#212121" />

            <androidx.appcompat.widget.SwitchCompat
                android:id="@+id/soundSwitch"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:checked="true" />

        </LinearLayout>

        <!-- â”€â”€ æŒ‰é’® â”€â”€ -->
        <Button
            android:id="@+id/btnSave"
            android:layout_width="match_parent"
            android:layout_height="48dp"
            android:text="ğŸ’¾ ä¿å­˜è®¾ç½®"
            android:textSize="18sp"
            android:textStyle="bold" />

        <Button
            android:id="@+id/btnReset"
            android:layout_width="match_parent"
            android:layout_height="48dp"
            android:text="â†© æ¢å¤é»˜è®¤"
            android:textSize="16sp"
            android:textColor="#F44336"
            android:layout_marginTop="8dp"
            style="@style/Widget.Material3.Button.OutlinedButton" />

    </LinearLayout>

</ScrollView>
```

#### Activity ä»£ç  (`SettingsActivity.kt`)

```kotlin
class SettingsActivity : AppCompatActivity() {

    private lateinit var prefs: SharedPreferences
    // SeekBar ç´¢å¼• 0-4 å¯¹åº”çš„ sp å€¼
    private val FONT_SIZES = intArrayOf(12, 14, 16, 18, 20)

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_settings)
        prefs = getSharedPreferences("app_settings", Context.MODE_PRIVATE)

        // â”€â”€ SeekBar å®æ—¶æ›´æ–°å³ä¾§æ ‡ç­¾ â”€â”€
        findViewById<SeekBar>(R.id.fontSizeSeekBar).setOnSeekBarChangeListener(
            object : SeekBar.OnSeekBarChangeListener {
                override fun onProgressChanged(seekBar: SeekBar?, progress: Int, fromUser: Boolean) {
                    val sp = FONT_SIZES[progress.coerceIn(0, FONT_SIZES.lastIndex)]
                    findViewById<TextView>(R.id.fontSizeLabel).text = "${sp}sp"
                }
                override fun onStartTrackingTouch(seekBar: SeekBar?) {}
                override fun onStopTrackingTouch(seekBar: SeekBar?) {}
            }
        )

        // â”€â”€ ä¿å­˜æŒ‰é’® â”€â”€
        findViewById<Button>(R.id.btnSave).setOnClickListener {
            saveSettings()
            Toast.makeText(this, "âœ“ è®¾ç½®å·²ä¿å­˜", Toast.LENGTH_SHORT).show()
        }

        // â”€â”€ æ¢å¤é»˜è®¤æŒ‰é’® â”€â”€
        findViewById<Button>(R.id.btnReset).setOnClickListener {
            AlertDialog.Builder(this)
                .setTitle("æ¢å¤é»˜è®¤è®¾ç½®")
                .setMessage("æ‰€æœ‰è®¾ç½®å°†æ¢å¤ä¸ºé»˜è®¤å€¼ï¼Œç¡®å®šå—ï¼Ÿ")
                .setPositiveButton("ç¡®è®¤") { dialog, _ ->
                    prefs.edit { clear() }   // æ¸…ç©ºæ‰€æœ‰æ•°æ®
                    loadSettings()           // ç”¨é»˜è®¤å€¼åˆ·æ–° UI
                    dialog.dismiss()
                    Toast.makeText(this, "å·²æ¢å¤é»˜è®¤è®¾ç½®", Toast.LENGTH_SHORT).show()
                }
                .setNegativeButton("å–æ¶ˆ") { dialog, _ -> dialog.dismiss() }
                .show()
        }

        // â”€â”€ é¡µé¢å¯åŠ¨æ—¶ï¼ŒåŠ è½½ä¸Šæ¬¡ä¿å­˜çš„è®¾ç½® â”€â”€
        loadSettings()
    }

    /** ä» SharedPreferences è¯»å–æ•°æ® â†’ æ›´æ–° UI */
    private fun loadSettings() {
        // æ˜µç§°
        findViewById<EditText>(R.id.nicknameEdit)
            .setText(prefs.getString("nickname", ""))

        // ä¸»é¢˜
        when (prefs.getString("theme", "light")) {
            "light" -> findViewById<RadioButton>(R.id.radioLight).isChecked = true
            "dark"  -> findViewById<RadioButton>(R.id.radioDark).isChecked  = true
            "auto"  -> findViewById<RadioButton>(R.id.radioAuto).isChecked  = true
        }

        // å­—ä½“å¤§å°ï¼ˆSP å€¼ â†’ SeekBar ç´¢å¼•ï¼‰
        val savedSize = prefs.getInt("fontSize", 16)
        val idx = FONT_SIZES.indexOf(savedSize).let { if (it < 0) 2 else it }
        findViewById<SeekBar>(R.id.fontSizeSeekBar).progress = idx
        findViewById<TextView>(R.id.fontSizeLabel).text = "${savedSize}sp"

        // å£°éŸ³å¼€å…³
        findViewById<androidx.appcompat.widget.SwitchCompat>(R.id.soundSwitch)
            .isChecked = prefs.getBoolean("soundEnabled", true)
    }

    /** è¯»å– UI å½“å‰çŠ¶æ€ â†’ å†™å…¥ SharedPreferences */
    private fun saveSettings() {
        val theme = when (findViewById<RadioGroup>(R.id.themeGroup).checkedRadioButtonId) {
            R.id.radioLight -> "light"
            R.id.radioDark  -> "dark"
            else            -> "auto"
        }
        val fontSize = FONT_SIZES[
            findViewById<SeekBar>(R.id.fontSizeSeekBar).progress.coerceIn(0, FONT_SIZES.lastIndex)
        ]

        prefs.edit {
            putString("nickname",      findViewById<EditText>(R.id.nicknameEdit).text.toString().trim())
            putString("theme",         theme)
            putInt("fontSize",         fontSize)
            putBoolean("soundEnabled",
                findViewById<androidx.appcompat.widget.SwitchCompat>(R.id.soundSwitch).isChecked)
        }
    }
}
```

**å®éªŒè¦ç‚¹å›é¡¾**:

- `loadSettings()` åœ¨ `onCreate` æœ«å°¾è°ƒç”¨ â†’ é¡µé¢æ‰“å¼€æ—¶è‡ªåŠ¨æ¢å¤
- SeekBar çš„ `progress` æ˜¯ç´¢å¼•ï¼ˆ0-4ï¼‰ï¼Œéœ€è¦æ˜ å°„åˆ°å®é™… sp å€¼
- `edit { ... }` ä»£ç å—è‡ªåŠ¨ applyï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨

---

### 5.2 å®éªŒäºŒï¼šä¿å­˜å’Œè¯»å–æ–‡æœ¬æ–‡ä»¶

**ç›®æ ‡**: åˆ›å»ºä¸€ä¸ªæç®€"æ–‡æœ¬ç¼–è¾‘å™¨"ï¼Œç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬å¯ä»¥ä¿å­˜åˆ°å†…éƒ¨å­˜å‚¨ï¼Œé‡å¯åè‡ªåŠ¨åŠ è½½ã€‚

#### å¸ƒå±€ (`activity_text_editor.xml`)

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <!-- çŠ¶æ€ä¿¡æ¯æ  -->
    <TextView
        android:id="@+id/statusBar"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="æ–°å»ºæ–‡æ¡£"
        android:textSize="13sp"
        android:textColor="#757575"
        android:padding="10dp 16dp"
        android:background="#F5F5F5" />

    <!-- ç¼–è¾‘åŒº -->
    <EditText
        android:id="@+id/contentEdit"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:hint="åœ¨æ­¤å¤„è¾“å…¥æ–‡æœ¬â€¦"
        android:inputType="textMultiline"
        android:gravity="top"
        android:textSize="16sp"
        android:padding="16dp"
        android:background="@android:color/transparent" />

    <!-- åº•éƒ¨æŒ‰é’®æ  -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="8dp"
        android:background="#FAFAFA">

        <Button
            android:id="@+id/btnSave"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="ğŸ’¾ ä¿å­˜"
            android:textSize="16sp"
            android:margin="4dp" />

        <Button
            android:id="@+id/btnLoad"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="ğŸ“‚ åŠ è½½"
            android:textSize="16sp"
            android:margin="4dp"
            style="@style/Widget.Material3.Button.OutlinedButton" />

        <Button
            android:id="@+id/btnClear"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="ğŸ—‘ï¸ æ¸…ç©º"
            android:textSize="16sp"
            android:textColor="#F44336"
            android:margin="4dp"
            style="@style/Widget.Material3.Button.OutlinedButton" />

    </LinearLayout>

</LinearLayout>
```

#### Activity ä»£ç  (`TextEditorActivity.kt`)

```kotlin
import java.io.File

class TextEditorActivity : AppCompatActivity() {

    private val FILE_NAME = "editor_draft.txt"   // ä¿å­˜çš„æ–‡ä»¶å

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_text_editor)

        val contentEdit = findViewById<EditText>(R.id.contentEdit)
        val statusBar   = findViewById<TextView>(R.id.statusBar)

        // â”€â”€ å¯åŠ¨æ—¶å°è¯•åŠ è½½ä¸Šæ¬¡ä¿å­˜çš„å†…å®¹ â”€â”€
        loadFile(contentEdit, statusBar)

        // â”€â”€ ä¿å­˜æŒ‰é’® â”€â”€
        findViewById<Button>(R.id.btnSave).setOnClickListener {
            val text = contentEdit.text.toString()
            try {
                val file = File(filesDir, FILE_NAME)
                file.writeText(text)
                statusBar.text = "âœ“ å·²ä¿å­˜  |  ${text.length} ä¸ªå­—ç¬¦  |  å¤§å°: ${file.length()} B"
                Toast.makeText(this, "ä¿å­˜æˆåŠŸ", Toast.LENGTH_SHORT).show()
            } catch (e: Exception) {
                Toast.makeText(this, "ä¿å­˜å¤±è´¥: ${e.message}", Toast.LENGTH_SHORT).show()
            }
        }

        // â”€â”€ åŠ è½½æŒ‰é’® â”€â”€
        findViewById<Button>(R.id.btnLoad).setOnClickListener {
            loadFile(contentEdit, statusBar)
            Toast.makeText(this, "å·²åŠ è½½", Toast.LENGTH_SHORT).show()
        }

        // â”€â”€ æ¸…ç©ºæŒ‰é’®ï¼ˆä»…æ¸…ç©ºç¼–è¾‘æ¡†ï¼Œä¸åˆ é™¤æ–‡ä»¶ï¼‰ â”€â”€
        findViewById<Button>(R.id.btnClear).setOnClickListener {
            AlertDialog.Builder(this)
                .setTitle("æ¸…ç©ºç¼–è¾‘å†…å®¹")
                .setMessage("ç¡®å®šæ¸…ç©ºï¼Ÿä¿å­˜çš„æ–‡ä»¶ä¸å—å½±å“ã€‚")
                .setPositiveButton("æ¸…ç©º") { dialog, _ ->
                    contentEdit.setText("")
                    statusBar.text = "å·²æ¸…ç©º"
                    dialog.dismiss()
                }
                .setNegativeButton("å–æ¶ˆ") { dialog, _ -> dialog.dismiss() }
                .show()
        }
    }

    /** ä»å†…éƒ¨å­˜å‚¨è¯»å–æ–‡ä»¶å†…å®¹ â†’ å¡«å…¥ EditText */
    private fun loadFile(editText: EditText, statusBar: TextView) {
        try {
            val file = File(filesDir, FILE_NAME)
            if (file.exists()) {
                val content = file.readText()
                editText.setText(content)
                statusBar.text = "å·²åŠ è½½  |  ${content.length} ä¸ªå­—ç¬¦  |  å¤§å°: ${file.length()} B"
            } else {
                statusBar.text = "æ–°å»ºæ–‡æ¡£ï¼ˆæœªä¿å­˜ï¼‰"
            }
        } catch (e: Exception) {
            Toast.makeText(this, "åŠ è½½å¤±è´¥: ${e.message}", Toast.LENGTH_SHORT).show()
        }
    }
}
```

**å®éªŒæ€è€ƒé¢˜**:

1. å¦‚æœæŠŠ `writeText()` æ¢æˆä¸¤æ¬¡è¿ç»­è°ƒç”¨ï¼Œç¬¬ä¸€æ¬¡å†™å…¥çš„å†…å®¹ä¼šæ¶ˆå¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
2. å¦‚æœæ–‡ä»¶è¢«æ‰‹åŠ¨åˆ é™¤ï¼Œç‚¹å‡»"åŠ è½½"ä¼šå´©æºƒå—ï¼Ÿä»£ç ä¸­å“ªé‡Œåšäº†é˜²æŠ¤ï¼Ÿ
3. æƒ³è®©æ¯æ¬¡ä¿å­˜éƒ½è¿½åŠ è€Œéè¦†ç›–ï¼Œåº”è¯¥æ¢ç”¨å“ªä¸ªæ–¹æ³•ï¼Ÿ

---

## ğŸ“ ç¬¬å…­éƒ¨åˆ†ï¼šè¯¾åä½œä¸š â€” ç®€å•è®°äº‹æœ¬åº”ç”¨

### 6.1 åº”ç”¨æ¦‚è¿°

å¼€å‘ä¸€ä¸ªåŸºäº**æ–‡ä»¶å­˜å‚¨**çš„è®°äº‹æœ¬åº”ç”¨ã€‚æ¯æ¡ç¬”è®°ä¿å­˜ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼Œæ”¯æŒæ–°å»ºã€æµè§ˆã€ç¼–è¾‘ã€åˆ é™¤ã€‚

#### åŠŸèƒ½è¦æ±‚

**å¿…éœ€åŠŸèƒ½**:

- âœ… é¦–é¡µï¼ˆç¬”è®°åˆ—è¡¨ï¼‰ï¼šæ˜¾ç¤ºæ‰€æœ‰å·²ä¿å­˜çš„ç¬”è®°æ ‡é¢˜å’Œé¢„è§ˆ
- âœ… æ–°å»ºç¬”è®°ï¼šè¾“å…¥æ ‡é¢˜å’Œå†…å®¹ï¼Œä¿å­˜åˆ°å†…éƒ¨å­˜å‚¨
- âœ… æµè§ˆç¬”è®°ï¼šç‚¹å‡»åˆ—è¡¨é¡¹æŸ¥çœ‹å®Œæ•´å†…å®¹
- âœ… åˆ é™¤ç¬”è®°ï¼šé•¿æŒ‰åˆ—è¡¨é¡¹æˆ–é€šè¿‡æŒ‰é’®ç¡®è®¤åˆ é™¤
- âœ… ç¬”è®°æ•°é‡ç»Ÿè®¡ï¼šåœ¨é¦–é¡µæ˜¾ç¤ºå½“å‰å…±æœ‰å¤šå°‘æ¡ç¬”è®°

**åŠ åˆ†åŠŸèƒ½**ï¼ˆå¯é€‰ï¼‰:

- âœ¨ ç¼–è¾‘å·²æœ‰ç¬”è®°
- âœ¨ æ˜¾ç¤ºæ¯æ¡ç¬”è®°çš„åˆ›å»ºæ—¶é—´
- âœ¨ æŒ‰åˆ›å»ºæ—¶é—´é™åºæ’åº
- âœ¨ æœç´¢/è¿‡æ»¤ç¬”è®°
- âœ¨ å¯¼å‡ºç¬”è®°åˆ°å¤–éƒ¨å­˜å‚¨

### 6.2 æ•°æ®è®¾è®¡

æ¯æ¡ç¬”è®°ä¿å­˜ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ååŒ…å«æ—¶é—´æˆ³ä¿è¯å”¯ä¸€ï¼š

```
å†…éƒ¨å­˜å‚¨ç›®å½•ç»“æ„:
filesDir/notes/
â”œâ”€â”€ note_1706000001.txt
â”œâ”€â”€ note_1706000045.txt
â”œâ”€â”€ note_1706000120.txt
â””â”€â”€ ...

å•ä¸ªæ–‡ä»¶å†…å®¹æ ¼å¼ï¼ˆç”¨æ¢è¡Œåˆ†éš”æ ‡é¢˜å’Œæ­£æ–‡ï¼‰:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ä»Šå¤©çš„æ„Ÿæƒ³
ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œå¿ƒæƒ…ä¸é”™ã€‚
ä¸‹åˆå»å…¬å›­æ•£æ­¥äº†ï¼Œå¾ˆæ”¾æ¾ã€‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¬¬ä¸€è¡Œ: æ ‡é¢˜
ç¬¬äºŒè¡Œèµ·: æ­£æ–‡å†…å®¹
```

**æ–‡ä»¶å‘½åè§„åˆ™**:

```kotlin
val fileName = "note_${System.currentTimeMillis()}.txt"
// ç¤ºä¾‹: note_1706123456789.txt
// æ—¶é—´æˆ³ä¿è¯æ–‡ä»¶åå”¯ä¸€ï¼Œé¿å…è¦†ç›–
```

### 6.3 é¡¹ç›®ç»“æ„

```
app/src/main/
â”œâ”€â”€ java/com.example.notepad/
â”‚   â”œâ”€â”€ MainActivity.kt          (ç¬”è®°åˆ—è¡¨é¡µ)
â”‚   â”œâ”€â”€ NoteEditorActivity.kt    (æ–°å»º/ç¼–è¾‘ç¬”è®°é¡µ)
â”‚   â”œâ”€â”€ NoteViewActivity.kt      (æŸ¥çœ‹ç¬”è®°é¡µ)
â”‚   â””â”€â”€ NoteManager.kt           (æ–‡ä»¶æ“ä½œå·¥å…·ç±»)
â”œâ”€â”€ res/layout/
â”‚   â”œâ”€â”€ activity_main.xml
â”‚   â”œâ”€â”€ activity_note_editor.xml
â”‚   â””â”€â”€ activity_note_view.xml
â””â”€â”€ AndroidManifest.xml
```

### 6.4 å®Œæ•´å‚è€ƒä»£ç 

#### NoteManager.kt â€” å·¥å…·ç±»ï¼ˆå°è£…æ‰€æœ‰æ–‡ä»¶æ“ä½œï¼‰

```kotlin
package com.example.notepad

import java.io.File

/**
 * ç¬”è®°æ–‡ä»¶ç®¡ç†å·¥å…·ç±»
 * å°è£…æ‰€æœ‰ä¸ç¬”è®°æ–‡ä»¶ç›¸å…³çš„è¯»å†™æ“ä½œ
 */
object NoteManager {

    private const val PREFIX = "note_"
    private const val SUFFIX = ".txt"
    private const val SEPARATOR = "\n"   // æ ‡é¢˜å’Œå†…å®¹ç”¨ç¬¬ä¸€ä¸ªæ¢è¡Œåˆ†éš”

    /** è·å–ç¬”è®°å­˜å‚¨ç›®å½•ï¼ˆä½äºå†…éƒ¨å­˜å‚¨çš„ notes å­ç›®å½•ï¼‰ */
    private fun getNotesDir(filesDir: File): File {
        val dir = File(filesDir, "notes")
        if (!dir.exists()) {
            dir.mkdirs()   // å¦‚æœç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º
        }
        return dir
    }

    /**
     * åˆ›å»ºæ–°ç¬”è®°
     * @return åˆ›å»ºçš„æ–‡ä»¶å
     */
    fun createNote(filesDir: File, title: String, content: String): String {
        val fileName = "$PREFIX${System.currentTimeMillis()}$SUFFIX"
        val file = File(getNotesDir(filesDir), fileName)
        file.writeText("$title$SEPARATOR$content")
        return fileName
    }

    /**
     * è¯»å–ç¬”è®°
     * @return Pair(æ ‡é¢˜, å†…å®¹)ï¼Œå¤±è´¥è¿”å› null
     */
    fun readNote(filesDir: File, fileName: String): Pair<String, String>? {
        val file = File(getNotesDir(filesDir), fileName)
        if (!file.exists()) return null

        val text = file.readText()
        val separatorIndex = text.indexOf(SEPARATOR)
        return if (separatorIndex >= 0) {
            val title   = text.substring(0, separatorIndex)
            val content = text.substring(separatorIndex + SEPARATOR.length)
            Pair(title, content)
        } else {
            // æ²¡æœ‰æ¢è¡Œç¬¦ï¼Œæ•´ä¸ªéƒ½å½“æ ‡é¢˜
            Pair(text, "")
        }
    }

    /**
     * æ›´æ–°å·²æœ‰ç¬”è®°
     */
    fun updateNote(filesDir: File, fileName: String, title: String, content: String) {
        val file = File(getNotesDir(filesDir), fileName)
        file.writeText("$title$SEPARATOR$content")
    }

    /**
     * åˆ é™¤ç¬”è®°
     * @return åˆ é™¤æ˜¯å¦æˆåŠŸ
     */
    fun deleteNote(filesDir: File, fileName: String): Boolean {
        val file = File(getNotesDir(filesDir), fileName)
        return file.delete()
    }

    /**
     * è·å–æ‰€æœ‰ç¬”è®°çš„æ–‡ä»¶ååˆ—è¡¨ï¼ˆæŒ‰ä¿®æ”¹æ—¶é—´é™åºæ’åˆ—ï¼‰
     */
    fun listNotes(filesDir: File): List<String> {
        val dir = getNotesDir(filesDir)
        return dir.listFiles()
            ?.filter { it.isFile && it.name.startsWith(PREFIX) && it.name.endsWith(SUFFIX) }
            ?.sortedByDescending { it.lastModified() }
            ?.map { it.name }
            ?: emptyList()
    }

    /**
     * è·å–ç¬”è®°æ€»æ•°
     */
    fun countNotes(filesDir: File): Int {
        return listNotes(filesDir).size
    }

    /**
     * ä»æ–‡ä»¶åè§£ææ—¶é—´æˆ³
     */
    fun getTimestamp(fileName: String): Long {
        val name = fileName.removePrefix(PREFIX).removeSuffix(SUFFIX)
        return name.toLongOrNull() ?: 0L
    }
}
```

#### MainActivity.kt â€” ç¬”è®°åˆ—è¡¨é¡µ

```kotlin
package com.example.notepad

import android.content.Intent
import android.os.Bundle
import android.widget.*
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity
import java.text.SimpleDateFormat
import java.util.*

class MainActivity : AppCompatActivity() {

    private lateinit var listView: ListView
    private lateinit var countText: TextView
    private val noteFileNames = mutableListOf<String>()   // å­˜å‚¨æ–‡ä»¶å

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        listView  = findViewById(R.id.noteListView)
        countText = findViewById(R.id.noteCountText)

        // æ–°å»ºæŒ‰é’®
        findViewById<Button>(R.id.btnNewNote).setOnClickListener {
            startActivity(Intent(this, NoteEditorActivity::class.java))
        }

        // åˆ—è¡¨é¡¹ç‚¹å‡» â†’ æŸ¥çœ‹ç¬”è®°
        listView.setOnItemClickListener { _, _, position, _ ->
            val fileName = noteFileNames[position]
            val intent = Intent(this, NoteViewActivity::class.java)
            intent.putExtra("fileName", fileName)
            startActivity(intent)
        }

        // åˆ—è¡¨é¡¹é•¿æŒ‰ â†’ åˆ é™¤ç¡®è®¤
        listView.setOnItemLongClickListener { _, _, position, _ ->
            val fileName = noteFileNames[position]
            val note = NoteManager.readNote(filesDir, fileName)
            val title = note?.first ?: "æœªå‘½å"

            AlertDialog.Builder(this)
                .setTitle("åˆ é™¤ç¬”è®°")
                .setMessage("ç¡®å®šè¦åˆ é™¤ ã€Œ$titleã€ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚")
                .setPositiveButton("åˆ é™¤") { dialog, _ ->
                    NoteManager.deleteNote(filesDir, fileName)
                    refreshList()
                    dialog.dismiss()
                    Toast.makeText(this, "å·²åˆ é™¤ ã€Œ$titleã€", Toast.LENGTH_SHORT).show()
                }
                .setNegativeButton("å–æ¶ˆ") { dialog, _ -> dialog.dismiss() }
                .show()
            true   // è¿”å› true è¡¨ç¤ºäº‹ä»¶å·²æ¶ˆè´¹
        }
    }

    // æ¯æ¬¡è¿”å›åˆ°åˆ—è¡¨é¡µæ—¶åˆ·æ–°ï¼ˆæ–°å¢/åˆ é™¤åéƒ½éœ€è¦åˆ·æ–°ï¼‰
    override fun onResume() {
        super.onResume()
        refreshList()
    }

    /** ä»æ–‡ä»¶ç³»ç»Ÿé‡æ–°è¯»å–ç¬”è®°åˆ—è¡¨å¹¶æ›´æ–° UI */
    private fun refreshList() {
        noteFileNames.clear()
        noteFileNames.addAll(NoteManager.listNotes(filesDir))

        // æ„å»ºæ˜¾ç¤ºåˆ—è¡¨çš„æ•°æ®
        val displayItems = noteFileNames.map { fileName ->
            val note      = NoteManager.readNote(filesDir, fileName)
            val title     = note?.first ?: "æœªå‘½å"
            val content   = note?.second ?: ""
            val preview   = content.take(30).replace("\n", " ")   // é¢„è§ˆå‰30å­—
            val timestamp = NoteManager.getTimestamp(fileName)
            val timeStr   = SimpleDateFormat("MM-dd HH:mm", Locale.getDefault())
                .format(Date(timestamp))
            "$title\n$previewâ€¦\n$timeStr"
        }

        val adapter = ArrayAdapter(this, android.R.layout.simple_list_item_1, displayItems)
        listView.adapter = adapter

        countText.text = "å…± ${noteFileNames.size} æ¡ç¬”è®°"
    }
}
```

#### activity_main.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <!-- é¡¶éƒ¨æ  -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="56dp"
        android:orientation="horizontal"
        android:gravity="center_vertical"
        android:background="#028090"
        android:paddingHorizontal="16dp">

        <TextView
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="ğŸ“ è®°äº‹æœ¬"
            android:textSize="22sp"
            android:textStyle="bold"
            android:textColor="@android:color/white" />

        <Button
            android:id="@+id/btnNewNote"
            android:layout_width="wrap_content"
            android:layout_height="36dp"
            android:text="ï¼‹ æ–°å»º"
            android:textSize="15sp"
            android:textColor="@android:color/white"
            android:background="@android:color/transparent"
            android:paddingHorizontal="12dp" />

    </LinearLayout>

    <!-- æ•°é‡æç¤º -->
    <TextView
        android:id="@+id/noteCountText"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="å…± 0 æ¡ç¬”è®°"
        android:textSize="13sp"
        android:textColor="#757575"
        android:padding="10dp 16dp"
        android:background="#F5F5F5" />

    <!-- ç¬”è®°åˆ—è¡¨ -->
    <ListView
        android:id="@+id/noteListView"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />

</LinearLayout>
```

#### NoteEditorActivity.kt â€” æ–°å»º/ç¼–è¾‘ç¬”è®°

```kotlin
package com.example.notepad

import android.os.Bundle
import android.widget.*
import androidx.appcompat.app.AppCompatActivity

class NoteEditorActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_note_editor)

        val titleEdit   = findViewById<EditText>(R.id.titleEdit)
        val contentEdit = findViewById<EditText>(R.id.contentEdit)
        val btnSave     = findViewById<Button>(R.id.btnSave)

        // å¦‚æœæ˜¯ç¼–è¾‘å·²æœ‰ç¬”è®°ï¼Œä¼šä» Intent ä¼ å…¥ fileName
        val fileName = intent.getStringExtra("fileName")
        if (fileName != null) {
            // ç¼–è¾‘æ¨¡å¼ï¼šé¢„å¡«å……æ•°æ®
            val note = NoteManager.readNote(filesDir, fileName)
            note?.let {
                titleEdit.setText(it.first)
                contentEdit.setText(it.second)
            }
        }

        btnSave.setOnClickListener {
            val title   = titleEdit.text.toString().trim()
            val content = contentEdit.text.toString()

            if (title.isEmpty()) {
                Toast.makeText(this, "æ ‡é¢˜ä¸èƒ½ä¸ºç©º", Toast.LENGTH_SHORT).show()
                return@setOnClickListener
            }

            if (fileName != null) {
                // ç¼–è¾‘æ¨¡å¼ â†’ æ›´æ–°æ–‡ä»¶
                NoteManager.updateNote(filesDir, fileName, title, content)
                Toast.makeText(this, "âœ“ å·²æ›´æ–°", Toast.LENGTH_SHORT).show()
            } else {
                // æ–°å»ºæ¨¡å¼ â†’ åˆ›å»ºæ–‡ä»¶
                NoteManager.createNote(filesDir, title, content)
                Toast.makeText(this, "âœ“ ç¬”è®°å·²ä¿å­˜", Toast.LENGTH_SHORT).show()
            }
            finish()   // ä¿å­˜åè¿”å›åˆ—è¡¨é¡µ
        }
    }
}
```

#### activity_note_editor.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <!-- æ ‡é¢˜è¾“å…¥ -->
    <EditText
        android:id="@+id/titleEdit"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:hint="ç¬”è®°æ ‡é¢˜"
        android:inputType="text"
        android:textSize="20sp"
        android:textStyle="bold"
        android:textColor="#212121"
        android:padding="16dp"
        android:background="@android:color/transparent" />

    <!-- åˆ†éš”çº¿ -->
    <View
        android:layout_width="match_parent"
        android:layout_height="1dp"
        android:background="#EEEEEE" />

    <!-- å†…å®¹ç¼–è¾‘åŒº -->
    <EditText
        android:id="@+id/contentEdit"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:hint="åœ¨æ­¤è¾“å…¥ç¬”è®°å†…å®¹â€¦"
        android:inputType="textMultiLine"
        android:gravity="top"
        android:textSize="16sp"
        android:textColor="#212121"
        android:padding="16dp"
        android:background="@android:color/transparent" />

    <!-- ä¿å­˜æŒ‰é’® -->
    <Button
        android:id="@+id/btnSave"
        android:layout_width="match_parent"
        android:layout_height="48dp"
        android:text="ğŸ’¾ ä¿å­˜ç¬”è®°"
        android:textSize="18sp"
        android:textStyle="bold" />

</LinearLayout>
```

#### NoteViewActivity.kt â€” æŸ¥çœ‹ç¬”è®°

```kotlin
package com.example.notepad

import android.content.Intent
import android.os.Bundle
import android.widget.*
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity

class NoteViewActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_note_view)

        val fileName = intent.getStringExtra("fileName") ?: run {
            Toast.makeText(this, "ç¬”è®°ä¸å­˜åœ¨", Toast.LENGTH_SHORT).show()
            finish()
            return
        }

        val note = NoteManager.readNote(filesDir, fileName)
        if (note == null) {
            Toast.makeText(this, "è¯»å–å¤±è´¥", Toast.LENGTH_SHORT).show()
            finish()
            return
        }

        findViewById<TextView>(R.id.viewTitle).text   = note.first
        findViewById<TextView>(R.id.viewContent).text = note.second

        // ç¼–è¾‘æŒ‰é’® â†’ è·³è½¬ç¼–è¾‘é¡µ
        findViewById<Button>(R.id.btnEdit).setOnClickListener {
            val intent = Intent(this, NoteEditorActivity::class.java)
            intent.putExtra("fileName", fileName)
            startActivity(intent)
        }

        // åˆ é™¤æŒ‰é’®
        findViewById<Button>(R.id.btnDelete).setOnClickListener {
            AlertDialog.Builder(this)
                .setTitle("åˆ é™¤ç¬”è®°")
                .setMessage("ç¡®å®šè¦åˆ é™¤ ã€Œ${note.first}ã€ï¼Ÿ")
                .setPositiveButton("åˆ é™¤") { dialog, _ ->
                    NoteManager.deleteNote(filesDir, fileName)
                    dialog.dismiss()
                    Toast.makeText(this, "å·²åˆ é™¤", Toast.LENGTH_SHORT).show()
                    finish()
                }
                .setNegativeButton("å–æ¶ˆ") { dialog, _ -> dialog.dismiss() }
                .show()
        }
    }

    // ç¼–è¾‘è¿”å›ååˆ·æ–°æ˜¾ç¤º
    override fun onResume() {
        super.onResume()
        val fileName = intent.getStringExtra("fileName") ?: return
        val note = NoteManager.readNote(filesDir, fileName) ?: return
        findViewById<TextView>(R.id.viewTitle).text   = note.first
        findViewById<TextView>(R.id.viewContent).text = note.second
    }
}
```

#### activity_note_view.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <!-- æ ‡é¢˜ -->
    <TextView
        android:id="@+id/viewTitle"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text=""
        android:textSize="22sp"
        android:textStyle="bold"
        android:textColor="#028090"
        android:padding="16dp"
        android:layout_marginBottom="4dp" />

    <!-- åˆ†éš”çº¿ -->
    <View
        android:layout_width="match_parent"
        android:layout_height="1dp"
        android:background="#EEEEEE"
        android:layout_marginHorizontal="16dp" />

    <!-- æ­£æ–‡å†…å®¹ -->
    <TextView
        android:id="@+id/viewContent"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:text=""
        android:textSize="16sp"
        android:textColor="#424242"
        android:padding="16dp"
        android:gravity="top" />

    <!-- åº•éƒ¨æŒ‰é’® -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="8dp"
        android:background="#FAFAFA">

        <Button
            android:id="@+id/btnEdit"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="âœï¸ ç¼–è¾‘"
            android:textSize="16sp"
            android:margin="4dp" />

        <Button
            android:id="@+id/btnDelete"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="ğŸ—‘ï¸ åˆ é™¤"
            android:textSize="16sp"
            android:textColor="#F44336"
            android:margin="4dp"
            style="@style/Widget.Material3.Button.OutlinedButton" />

    </LinearLayout>

</LinearLayout>
```

#### AndroidManifest.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.example.notepad">

    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="è®°äº‹æœ¬"
        android:theme="@style/Theme.Notepad">

        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:label="è®°äº‹æœ¬">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

        <activity
            android:name=".NoteEditorActivity"
            android:exported="false"
            android:label="ç¼–è¾‘ç¬”è®°" />

        <activity
            android:name=".NoteViewActivity"
            android:exported="false"
            android:label="æŸ¥çœ‹ç¬”è®°" />

    </application>

</manifest>
```

### 6.5 è¯„åˆ†æ ‡å‡†

|é¡¹ç›®|åˆ†å€¼|è¯„åˆ†ç»†åˆ™|
|---|---|---|
|æ–°å»ºä¸ä¿å­˜|25%|è¾“å…¥æ ‡é¢˜å’Œå†…å®¹åèƒ½æ­£ç¡®ä¿å­˜åˆ°æ–‡ä»¶|
|åˆ—è¡¨å±•ç¤º|20%|é¦–é¡µèƒ½åˆ—å‡ºæ‰€æœ‰å·²ä¿å­˜ç¬”è®°ï¼Œé‡å¯åæ•°æ®ä¸ä¸¢å¤±|
|æŸ¥çœ‹ç¬”è®°|15%|ç‚¹å‡»åˆ—è¡¨é¡¹èƒ½å®Œæ•´æ˜¾ç¤ºæ ‡é¢˜å’Œå†…å®¹|
|åˆ é™¤ç¬”è®°|15%|åˆ é™¤å‰å¼¹å‡ºç¡®è®¤ Dialogï¼Œåˆ é™¤ååˆ—è¡¨åŒæ­¥æ›´æ–°|
|UI è®¾è®¡|15%|ç•Œé¢å¸ƒå±€åˆç†ï¼Œé¢œè‰²å’Œå­—ä½“ä½¿ç”¨å¾—å½“|
|ä»£ç è´¨é‡|10%|å‘½åè§„èŒƒã€é€‚å½“æ³¨é‡Šã€é€»è¾‘æ¸…æ™°|

#### åŠ åˆ†é¡¹ï¼ˆå¯é€‰ï¼Œæ¯é¡¹+5åˆ†ï¼Œä¸Šé™+15åˆ†ï¼‰

- âœ¨ ç¼–è¾‘å·²æœ‰ç¬”è®°åŠŸèƒ½å®Œæ•´å¯ç”¨
- âœ¨ æ¯æ¡ç¬”è®°æ˜¾ç¤ºåˆ›å»ºæ—¶é—´
- âœ¨ ç¬”è®°åˆ—è¡¨æŒ‰æ—¶é—´é™åºæ’åˆ—
- âœ¨ æœç´¢/è¿‡æ»¤åŠŸèƒ½å¯ç”¨
- âœ¨ å°†å·¥å…·æ–¹æ³•å°è£…ä¸ºç‹¬ç«‹çš„å·¥å…·ç±»ï¼ˆNoteManagerï¼‰

#### æäº¤è¦æ±‚

1. **æºä»£ç ** â€” å®Œæ•´ Android é¡¹ç›®ï¼ˆZIP å‹ç¼©åŒ…ï¼‰
2. **è¿è¡Œæˆªå›¾** â€” è‡³å°‘5å¼ ï¼ˆç©ºåˆ—è¡¨ã€æ–°å»ºç¬”è®°ã€åˆ—è¡¨å±•ç¤ºã€æŸ¥çœ‹ç¬”è®°ã€åˆ é™¤ç¡®è®¤å¼¹çª—ï¼‰
3. **è¯´æ˜æ–‡æ¡£** â€” README.mdï¼ˆåŠŸèƒ½ä»‹ç»ã€æ•°æ®å­˜å‚¨æ–¹æ¡ˆè¯´æ˜ã€é‡åˆ°çš„é—®é¢˜å’Œè§£å†³è¿‡ç¨‹ï¼‰

**æ–‡ä»¶å‘½å**: `å§“å_å­¦å·_Week6_è®°äº‹æœ¬.zip`  
**æˆªæ­¢æ—¶é—´**: ç¬¬7å‘¨å‘¨ä¸€ä¸Šè¯¾å‰

---

## ğŸ’¡ ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæœ€ä½³å®è·µä¸å¸¸è§å‘

### 7.1 SharedPreferences å¸¸è§å‘

```kotlin
// â”€â”€â”€ å‘â‘ : å¿˜è®° apply() â”€â”€â”€
prefs.edit().putString("key", "value")   // âŒ æ²¡æœ‰ applyï¼Œä¸ä¼šä¿å­˜ï¼
prefs.edit { putString("key", "value") } // âœ… edit{} ä»£ç å—è‡ªåŠ¨ apply

// â”€â”€â”€ å‘â‘¡: æ¯æ¬¡éƒ½ edit().put().apply() â”€â”€â”€
// âŒ ä½æ•ˆï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–° Editor
prefs.edit { putString("a", "1") }
prefs.edit { putString("b", "2") }
prefs.edit { putString("c", "3") }

// âœ… é«˜æ•ˆï¼šä¸€æ¬¡ edit å—å†™å®Œæ‰€æœ‰å€¼
prefs.edit {
    putString("a", "1")
    putString("b", "2")
    putString("c", "3")
}

// â”€â”€â”€ å‘â‘¢: ç”¨ SP å­˜å¤§é‡æ•°æ® â”€â”€â”€
// âŒ SP ä¸é€‚åˆå­˜å‚¨å‡ ç™¾æ¡ä»¥ä¸Šçš„æ•°æ®
// âœ… å¤§é‡æ•°æ®åº”ä½¿ç”¨ SQLite / Roomï¼ˆåç»­å­¦ä¹ ï¼‰
```

### 7.2 æ–‡ä»¶æ“ä½œå¸¸è§å‘

```kotlin
// â”€â”€â”€ å‘â‘ : æ²¡æœ‰åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨å°±è¯»å– â”€â”€â”€
val file = File(filesDir, "data.txt")
val content = file.readText()   // âŒ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼ŒæŠ›å‡º FileNotFoundException

// âœ… å…ˆåˆ¤æ–­
if (file.exists()) {
    val content = file.readText()
}

// â”€â”€â”€ å‘â‘¡: æ²¡æœ‰å¤„ç†å¼‚å¸¸ â”€â”€â”€
// âŒ ä¸‡ä¸€ç£ç›˜ç©ºé—´ä¸è¶³ï¼ŒwriteText ä¼šå´©æºƒ
file.writeText(content)

// âœ… ç”¨ try-catch åŒ…è£¹
try {
    file.writeText(content)
} catch (e: Exception) {
    Toast.makeText(this, "å†™å…¥å¤±è´¥: ${e.message}", Toast.LENGTH_SHORT).show()
}

// â”€â”€â”€ å‘â‘¢: æ··æ·†è¦†ç›–å’Œè¿½åŠ  â”€â”€â”€
file.writeText("å†…å®¹A")     // è¦†ç›–å†™å…¥ â†’ æ–‡ä»¶å†…å®¹å˜ä¸º "å†…å®¹A"
file.writeText("å†…å®¹B")     // å†æ¬¡è¦†ç›– â†’ æ–‡ä»¶å†…å®¹å˜ä¸º "å†…å®¹B"ï¼ˆA æ¶ˆå¤±äº†ï¼ï¼‰
file.appendText("å†…å®¹C")    // è¿½åŠ      â†’ æ–‡ä»¶å†…å®¹å˜ä¸º "å†…å®¹BC"
```

### 7.3 æ–‡ä»¶å‘½åè§„èŒƒ

```kotlin
// âŒ ä¸è¦ç”¨ç”¨æˆ·è¾“å…¥ç›´æ¥å½“æ–‡ä»¶åï¼ˆå¯èƒ½åŒ…å«éæ³•å­—ç¬¦ï¼‰
val fileName = "${userInput}.txt"   // å¦‚æœ userInput = "æˆ‘çš„:ç¬”è®°/2"ï¼Œä¼šå´©æºƒ

// âœ… ç”¨æ—¶é—´æˆ³æˆ–éšæœºIDåšæ–‡ä»¶åï¼Œæ ‡é¢˜å­˜åœ¨æ–‡ä»¶å†…å®¹é‡Œ
val fileName = "note_${System.currentTimeMillis()}.txt"

// âœ… æˆ–è€…ç”¨ UUID
import java.util.UUID
val fileName = "${UUID.randomUUID()}.txt"
```

### 7.4 å·¥å…·ç±»å°è£…çš„å¥½å¤„

```
âŒ æ²¡æœ‰å°è£…æ—¶:
MainActivity.kt          é‡Œé¢å†™ File(filesDir, ...).writeText(...)
NoteEditorActivity.kt   é‡Œé¢ä¹Ÿå†™ä¸€æ ·çš„ä»£ç 
NoteViewActivity.kt     é‡Œé¢ä¹Ÿå†™ä¸€æ ·çš„ä»£ç 
â†’ ä¸‰ä¸ªåœ°æ–¹é‡å¤ä»£ç ï¼Œæ”¹ä¸€å¤„æ¼æ‰ä¸¤å¤„

âœ… å°è£… NoteManager å:
æ‰€æœ‰ Activity éƒ½è°ƒç”¨ NoteManager.createNote(...)
åº•å±‚é€»è¾‘åªåœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ”¹èµ·æ¥æ–¹ä¾¿ã€ä¸å®¹æ˜“å‡ºé”™
```

---

## ğŸ† ç¬¬ä¸€é˜¶æ®µé¡¹ç›®å±•ç¤º

> ğŸ“… **æ—¶é—´**: ç¬¬6å‘¨å‘¨äº”è¯¾å ‚

### é¡¹ç›®è¦æ±‚

æ¯ä½åŒå­¦éœ€è¦å±•ç¤ºä¸€ä¸ª**å•å±åº”ç”¨**ï¼ˆä¸€ä¸ª Activity å®Œæˆæ‰€æœ‰åŠŸèƒ½ï¼‰ï¼Œç»¼åˆè¿ç”¨ç¬¬1-6å‘¨å­¦åˆ°çš„çŸ¥è¯†ã€‚

**ä¸»é¢˜è‡ªç”±é€‰æ‹©**ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å‚è€ƒé¢˜ç›®:

- ğŸ“Š çŒœæ•°å­—æ¸¸æˆï¼ˆ1-100éšæœºæ•°ï¼‰
- ğŸ§® å•ä½æ¢ç®—å·¥å…·ï¼ˆé•¿åº¦/æ¸©åº¦/é¢ç§¯/è´§å¸ï¼‰
- ğŸ² éª°å­æ¨¡æ‹Ÿå™¨ï¼ˆæ”¯æŒå¤šä¸ªéª°å­ï¼‰
- ğŸ“ ç®€å•å¾…åŠæ¸…å•ï¼ˆå•å±ç‰ˆï¼Œç”¨ SharedPreferences å­˜å‚¨ï¼‰
- ğŸ¨ é¢œè‰²ç”Ÿæˆå™¨ï¼ˆéšæœºé¢œè‰² + æ˜¾ç¤ºRGB/åå…­è¿›åˆ¶ï¼‰
- ğŸ“ BMI è®¡ç®—å™¨ï¼ˆèº«é«˜ä½“é‡ â†’ BMIå€¼ + å¥åº·å»ºè®®ï¼‰

### å¿…é¡»åŒ…å«çš„æŠ€æœ¯ç‚¹

1. âœ… è‡³å°‘ä¸¤ç§ä»¥ä¸Šä¸åŒçš„ UI æ§ä»¶ï¼ˆButtonã€EditTextã€TextViewã€SeekBar ç­‰ï¼‰
2. âœ… äº‹ä»¶ç›‘å¬å’Œå“åº”
3. âœ… ä½¿ç”¨ SharedPreferences æˆ–æ–‡ä»¶å­˜å‚¨ä¿å­˜è‡³å°‘ä¸€ä¸ªæ•°æ®
4. âœ… è‡³å°‘ä½¿ç”¨ä¸€æ¬¡ Toast æˆ– Dialog
5. âœ… ä»£ç æœ‰é€‚å½“çš„æ³¨é‡Š

### å±•ç¤ºå†…å®¹ï¼ˆ3åˆ†é’Ÿ/äººï¼‰

1. **æ¼”ç¤º** â€” æ‰“å¼€åº”ç”¨ï¼Œå±•ç¤ºæ ¸å¿ƒåŠŸèƒ½
2. **ç®€è¿°æ€è·¯** â€” è¯´æ˜ä½ æ˜¯æ€ä¹ˆè®¾è®¡çš„
3. **å›ç­”é—®é¢˜** â€” è€å¸ˆå¯èƒ½æé—®ä»£ç ç»†èŠ‚

### è¯„åˆ†æ ‡å‡†

|é¡¹ç›®|åˆ†å€¼|
|---|---|
|åŠŸèƒ½å®Œæ•´æ€§|30%|
|æŠ€æœ¯ç‚¹è¦†ç›–|30%|
|UI è®¾è®¡|20%|
|å±•ç¤ºè¡¨è¾¾|15%|
|ä»£ç è´¨é‡|5%|

> ğŸ’¡ **æç¤º**: é¡¹ç›®ä¸ç”¨å¾ˆå¤æ‚ï¼ŒåŠŸèƒ½å®ç°æ¸…æ¥šã€æ¼”ç¤ºæµç•…æ¯”ä»€ä¹ˆéƒ½é‡è¦ï¼

---

## ğŸ¯ è¯¾åæ€è€ƒé¢˜

1. **SharedPreferences çš„ `apply()` å’Œ `commit()` åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨å“ªä¸ªï¼Ÿ**
    
2. **å¦‚æœæƒ³è®©è®°äº‹æœ¬çš„æ•°æ®åœ¨å¸è½½åº”ç”¨åä»ç„¶ä¿ç•™ï¼Œåº”è¯¥æŠŠæ–‡ä»¶å­˜åˆ°å“ªé‡Œï¼Ÿ**
    
3. **æ–‡ä»¶çš„ `writeText()` å’Œ `appendText()` åˆ†åˆ«ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿå¦‚æœä½ ç”¨é”™äº†ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ**
    
4. **ä½ çš„è®°äº‹æœ¬åº”ç”¨å¦‚ä½•ä¿è¯ä¸¤æ¡ç¬”è®°çš„æ–‡ä»¶åä¸ä¼šé‡å¤ï¼Ÿå¦‚æœæœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæ˜¯ä»€ä¹ˆï¼Ÿ**
    
5. **ä¸ºä»€ä¹ˆè¦æŠŠæ–‡ä»¶æ“ä½œå°è£…åˆ°å•ç‹¬çš„å·¥å…·ç±»ï¼Œè€Œä¸æ˜¯ç›´æ¥å†™åœ¨ Activity é‡Œï¼Ÿä¸¾ä¾‹è¯´æ˜å¥½å¤„ã€‚**
    

---

## ğŸ“š æ‰©å±•é˜…è¯»

### å®˜æ–¹æ–‡æ¡£

- [SharedPreferences](https://developer.android.com/develop/data/data-storage/shared-preferences)
- [æ–‡ä»¶å­˜å‚¨ï¼ˆå†…éƒ¨å­˜å‚¨ï¼‰](https://developer.android.com/develop/data/data-storage/app-specific#internal)
- [æ–‡ä»¶å­˜å‚¨ï¼ˆå¤–éƒ¨å­˜å‚¨ï¼‰](https://developer.android.com/develop/data/data-storage/app-specific#external)
- [æƒé™æ¦‚è¿°](https://developer.android.com/develop/security/app-permissions)

### æ¨èæ–‡ç« 

- [Android Data Storage â€“ SharedPreferences vs Files vs Database](https://developer.android.com/develop/data/data-storage)
- [Best Practices for App Permissions](https://developer.android.com/develop/security/app-permissions/request)

---

## ğŸ“ ä¸‹å‘¨é¢„å‘Š

**ç¬¬7å‘¨ï¼šRecyclerView ä¸åˆ—è¡¨æ˜¾ç¤º**

- RecyclerView åŸºç¡€æ¦‚å¿µå’Œä¼˜åŠ¿
- Adapter æ¨¡å¼ï¼ˆä¸ºä»€ä¹ˆéœ€è¦ Adapterï¼Ÿï¼‰
- ViewHolder è®¾è®¡æ¨¡å¼ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- åˆ—è¡¨é¡¹çš„ç‚¹å‡»äº‹ä»¶å¤„ç†
- å®è·µï¼šåˆ›å»ºè”ç³»äººåˆ—è¡¨åº”ç”¨

**é¢„ä¹ å»ºè®®**:

- å¤ä¹ æœ¬å‘¨çš„æ–‡ä»¶å­˜å‚¨çŸ¥è¯†ï¼ˆä¸‹å‘¨çš„åˆ—è¡¨æ•°æ®ä¹Ÿå¯ä»¥ä¿å­˜åˆ°æ–‡ä»¶ï¼‰
- æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœè¦æ˜¾ç¤ºä¸€ç™¾æ¡æ•°æ®ï¼Œèƒ½ä¸èƒ½ä¸€æ¬¡éƒ½æ”¾åˆ°ç•Œé¢ä¸Šï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
- äº†è§£"é€‚é…å™¨"æ˜¯ä»€ä¹ˆæ¦‚å¿µ

---

**è¯¾ç¨‹èµ„æ–™æ›´æ–°æ—¶é—´**: 2026å¹´2æœˆ  
**è®²å¸ˆ**: [æ•™å¸ˆå§“å]  
**è”ç³»æ–¹å¼**: [é‚®ç®±]

_æ•°æ®å­˜å‚¨æ˜¯åº”ç”¨å¼€å‘çš„åŸºç¡€ï¼è®°äº‹æœ¬é¡¹ç›®å¾ˆé€‚åˆåå¤ç»ƒä¹ ï¼Œå»ºè®®å¤§å®¶æŠŠå‚è€ƒä»£ç ç†è§£ä¹‹åè‡ªå·±é‡å†™ä¸€éã€‚åŠ æ²¹ï¼ğŸš€_